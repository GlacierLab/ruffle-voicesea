<!DOCTYPE html>
<html>
<title>VoicesFromTheSea-Online</title>

<head>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <style>
        body {
            -webkit-font-smoothing: subpixel-antialiased;
        }

        .unselect {
            -webkit-user-select: none;
            user-select: none;
        }

        #player {
            width: auto;
            height: auto;
            position: absolute;
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
        }
    </style>
</head>

<body id="container" style="width:100%;height:100%;">
    <div style="position:fixed;z-index:999;height:100%;width:100%;text-align:center;background-color: rgba(200,200,200,1); top: 0px;bottom: 0px;left: 0px;right: 0px;"
        id="loginOverlay">
        <H3 style="position: absolute;	left: 50%;top: 50%;transform: translate(-50%,-50%);" id="loadtext">正在加载页面...</H3>
    </div>
    </div>
    <script src="https://cdn.jsdelivr.net/gh/qinlili23333/SakiProgress@1.0.3/SakiProgress.min.js"></script>
    <script>
        SakiProgress.init();
        SakiProgress.showDiv();
    </script>
    <script src="https://voicesea.qinlili.bid/ruffle.js"></script>
    <script>
        var percent = 0;
        var p = function (add) {
            percent = percent + add;
            SakiProgress.setPercent(percent)
        };
        var t = function(text){SakiProgress.setText(text)};
        t("正在下载文件分块（共2块）");
        p(5);
        var fullblob;
        var blob0;
        var blob1;
        fetch("https://voicesea.qinlili.bid/swfpack0.bin").then(res => res.blob().then(blob => {
            blob0 = blob;
            p(20);
            checkLoad();
        }))
        fetch("https://voicesea.qinlili.bid/swfpack1.bin").then(res => res.blob().then(blob => {
            blob1 = blob;
            p(20);
            checkLoad();
        }))
        function checkLoad() {
            if (blob0 && blob1) {
                t("正在合并文件")
                fullblob = new Blob([blob0, blob1], { type: "application/x-shockwave-flash" });
                p(5);
                loadswf();
            }
        }
        function loadswf() {
            t("正在创建界面");
            window.RufflePlayer = window.RufflePlayer || {};
            let ruffle = window.RufflePlayer.newest();
            p(10)
            t("正在下载Ruffle二进制");
            let player = ruffle.createPlayer();
            player.config = {
                "autoplay": "auto",
                "unmuteOverlay": "hidden",
                "letterbox": "on",
                "warnOnUnsupportedContent": false,
                "contextMenu": false,
            }
            let container = document.getElementById("container");
            player.id = "player";
            container.appendChild(player);
            p(15)
            t("正在读取文件");
            player.load(window.URL.createObjectURL(fullblob)).then(() => {
                p(5)
                t("正在渲染界面大约需要半分钟");
                setTimeout(function () {
                    document.getElementById("loginOverlay").style.display = "none";
                    p(20);
                    SakiProgress.hideDiv();
                }, 1500)
            }).catch((e) => {
                alert("加载失败！原因为" + e);
            });
        }

    </script>
</body>

</html>
